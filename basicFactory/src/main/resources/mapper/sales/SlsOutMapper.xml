<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mes.bf.sales.mapper.SlsOutMapper">
	
	<resultMap type="slsOutHdVO" id="outHdMap">
		<id property="slsOutHdNo" column="sls_out_hd_no"/>
		<result property="slsOrdHdNo" column="sls_ord_hd_no"/>
		<result property="slsOutHdDate" column="sls_out_hd_date"/>
		<result property="vendCdCode" column="vend_cd_code"/>
		<result property="vendCdNm" column="vend_cd_nm"/>
		<result property="empId" column="emp_id"/>
		<result property="empName" column="emp_name"/>
		<result property="slsOutHdRemk" column="sls_out_hd_remk"/>
	</resultMap>
	
	<resultMap type="slsOutDtlVO" id="outDtlMap">
		<id property="slsOutDtlNo" column="sls_out_dtl_no"/>
		<result property="slsOutHdNo" column="sls_out_hd_no"/>
		<result property="finPrdCdCode" column="fin_prd_cd_code"/>
		<result property="finPrdCdName" column="fin_prd_cd_name"/>
		<result property="fnsPrdStkLotNo" column="fns_prd_stk_lot_no"/>
		<result property="slsOrdDtlVol" column="sls_ord_dtl_vol"/>
		<result property="slsOutDtlPrvsVol" column="sls_out_dtl_prvs_vol"/>
		<result property="slsOutDtlVol" column="sls_out_dtl_vol"/>
		<result property="slsOrdDtlNotOutVol" column="sls_ord_dtl_not_out_vol"/>
		<result property="finPrdCdPrice" column="fin_prd_cd_price"/>
		<result property="slsOutDtlPrice" column="sls_out_dtl_price"/>
	</resultMap>
	
	<resultMap type="slsOrdDtlVO" id="ordDtlMap">
		<result property="slsOrdDtlVol" column="sls_ord_dtl_vol" />
		<result property="slsOrdDtlOutVol" column="sls_ord_dtl_out_vol" />
	</resultMap>
	
	<resultMap type="outHdDtl" id="outHdDtlMap">
		<collection property="slsOutHdVO" resultMap="outHdMap"/>
		<collection property="slsOutDtlVO" resultMap="outDtlMap"/>
		<collection property="slsOrdDtlVO" resultMap="ordDtlMap"/>
	</resultMap>
	
	<select id="findAllOut" resultMap="outHdDtlMap">
	SELECT OUTHD.SLS_OUT_HD_DATE,
		   OUTHD.SLS_OUT_HD_NO,
           VEND.VEND_CD_NM,
           FNSPRD.FIN_PRD_CD_CODE,
		   FNSPRD.FIN_PRD_CD_NAME,
           OUTHD.SLS_ORD_HD_NO,
           ORDDTL.SLS_ORD_DTL_VOL,
		   OUTDTL.SLS_OUT_DTL_PRVS_VOL,
		   OUTDTL.SLS_OUT_DTL_VOL,
		   ORDDTL.SLS_ORD_DTL_NOT_OUT_VOL,
		   OUTDTL.FNS_PRD_STK_LOT_NO,
           FNSPRD.FIN_PRD_CD_PRICE,
		   OUTDTL.SLS_OUT_DTL_PRICE,
		   EMP.EMP_NAME,
		   NVL(OUTHD.SLS_OUT_HD_REMK, ' ') AS SLS_OUT_HD_REMK
		FROM BF_SALES_OUT_HD OUTHD
		JOIN BF_SALES_OUT_DTL OUTDTL
    	  ON OUTHD.SLS_OUT_HD_NO = OUTDTL.SLS_OUT_HD_NO
  		JOIN BF_SALES_ORD_HD ORDHD
    	  ON ORDHD.SLS_ORD_HD_NO = OUTHD.SLS_ORD_HD_NO
 		JOIN BF_SALES_ORD_DTL ORDDTL
    	  ON ORDHD.SLS_ORD_HD_NO = ORDDTL.SLS_ORD_HD_NO
 		JOIN BF_CMN_EMP EMP
   		  ON EMP.EMP_ID = OUTHD.EMP_ID
 		JOIN BF_CMN_VENDOR_CODE VEND
    	  ON VEND.VEND_CD_CODE = OUTHD.VEND_CD_CODE
 		JOIN BF_CMN_FINISH_PRODUCT_CODE FNSPRD
    	  ON FNSPRD.FIN_PRD_CD_CODE = OUTDTL.FIN_PRD_CD_CODE
 		JOIN BF_SALES_FINISH_PRODUCT_STOK FNSPRDSK
    	  ON FNSPRDSK.FNS_PRD_STK_LOT_NO = OUTDTL.FNS_PRD_STK_LOT_NO
 		WHERE ORDDTL.FIN_PRD_CD_CODE = OUTDTL.FIN_PRD_CD_CODE
 		ORDER BY SLS_OUT_HD_DATE DESC, SLS_OUT_HD_NO DESC
	</select>
	
	<select id="findOut" resultMap="outHdDtlMap">
	SELECT OUTHD.SLS_OUT_HD_DATE,
		   OUTHD.SLS_OUT_HD_NO,
           VEND.VEND_CD_NM,
           FNSPRD.FIN_PRD_CD_CODE,
		   FNSPRD.FIN_PRD_CD_NAME,
           OUTHD.SLS_ORD_HD_NO,
           ORDDTL.SLS_ORD_DTL_VOL,
		   OUTDTL.SLS_OUT_DTL_PRVS_VOL,
		   OUTDTL.SLS_OUT_DTL_VOL,
		   ORDDTL.SLS_ORD_DTL_NOT_OUT_VOL,
		   OUTDTL.FNS_PRD_STK_LOT_NO,
           FNSPRD.FIN_PRD_CD_PRICE,
		   OUTDTL.SLS_OUT_DTL_PRICE,
		   EMP.EMP_NAME,
		   NVL(OUTHD.SLS_OUT_HD_REMK, ' ') AS SLS_OUT_HD_REMK
	FROM BF_SALES_OUT_HD OUTHD
	JOIN BF_SALES_OUT_DTL OUTDTL
   	  ON OUTHD.SLS_OUT_HD_NO = OUTDTL.SLS_OUT_HD_NO
 	JOIN BF_SALES_ORD_HD ORDHD
   	  ON ORDHD.SLS_ORD_HD_NO = OUTHD.SLS_ORD_HD_NO
	JOIN BF_SALES_ORD_DTL ORDDTL
   	  ON ORDHD.SLS_ORD_HD_NO = ORDDTL.SLS_ORD_HD_NO
	JOIN BF_CMN_EMP EMP
  	  ON EMP.EMP_ID = OUTHD.EMP_ID
	JOIN BF_CMN_VENDOR_CODE VEND
   	  ON VEND.VEND_CD_CODE = OUTHD.VEND_CD_CODE
	JOIN BF_CMN_FINISH_PRODUCT_CODE FNSPRD
   	  ON FNSPRD.FIN_PRD_CD_CODE = OUTDTL.FIN_PRD_CD_CODE
	JOIN BF_SALES_FINISH_PRODUCT_STOK FNSPRDSK
   	  ON FNSPRDSK.FNS_PRD_STK_LOT_NO = OUTDTL.FNS_PRD_STK_LOT_NO
   	  
	WHERE ORDDTL.FIN_PRD_CD_CODE = OUTDTL.FIN_PRD_CD_CODE
	
		<if test="(outSdate != null and outSdate != '') and (outEdate != null and outEdate != '')">
			AND OUTHD.SLS_OUT_HD_DATE BETWEEN  TO_DATE(#{outSdate}, 'YY/MM/DD') AND TO_DATE(#{outEdate}, 'YY/MM/DD') + 0.9999
		</if>
		<if test="vendorName != null and vendorName != ''">
			AND VEND.VEND_CD_NM = #{vendorName}
		</if>
	ORDER BY SLS_OUT_HD_DATE DESC, SLS_OUT_HD_NO DESC
	</select>
	
	
	<!-- 출고관리에서 미출고 주문 조회 모달-->
   	<select id="findNotOut" resultType="slsOrdHdVO">
   		SELECT DISTINCT ORDHD.SLS_ORD_HD_NO,
   			   ORDHD.SLS_ORD_HD_DATE,
   			   VEND.VEND_CD_CODE,
   			   VEND.VEND_CD_NM,
   			   EMP.EMP_NAME,
   			   NVL(ORDHD.SLS_ORD_HD_REMK, ' ') AS SLS_ORD_HD_REMK
   		FROM BF_SALES_ORD_HD ORDHD
   		JOIN BF_SALES_ORD_DTL ORDDTL
   		  ON ORDDTL.SLS_ORD_HD_NO = ORDHD.SLS_ORD_HD_NO
   		JOIN BF_CMN_VENDOR_CODE VEND
   		  ON ORDHD.VEND_CD_CODE = VEND.VEND_CD_CODE
   		JOIN BF_CMN_EMP EMP
   		  ON ORDHD.EMP_ID = EMP.EMP_ID
   		  
		WHERE ORDDTL.SLS_ORD_DTL_NOT_OUT_VOL > 0
   		<if test="(ordSdate != null and ordSdate != '') and (ordEdate != null and ordEdate != '')">
   			AND ORDHD.SLS_ORD_HD_DATE BETWEEN  TO_DATE(#{ordSdate}, 'YY/MM/DD') AND TO_DATE(#{ordEdate}, 'YY/MM/DD') + 0.9999
        </if>
        ORDER BY SLS_ORD_HD_DATE DESC, SLS_ORD_HD_NO DESC
   	</select>
   	
   	<!-- 출고관리에서 미출고 주문 상세조회 모달-->
   	<select id="findNotOutDtl" resultMap="outHdDtlMap">
   		SELECT FNSPRD.FIN_PRD_CD_CODE,
               FNSPRD.FIN_PRD_CD_NAME,
               ORDDTL.SLS_ORD_DTL_VOL,
               NVL(ORDDTL.SLS_ORD_DTL_OUT_VOL, 0) AS SLS_ORD_DTL_OUT_VOL,
               FNSPRD.FIN_PRD_CD_PRICE
   		FROM BF_SALES_OUT_DTL OUTDTL
        JOIN BF_SALES_OUT_HD OUTHD
          ON OUTDTL.SLS_OUT_HD_NO = OUTHD.SLS_OUT_HD_NO
        JOIN BF_SALES_ORD_HD ORDHD
          ON ORDHD.SLS_ORD_HD_NO = OUTHD.SLS_ORD_HD_NO
        RIGHT JOIN BF_SALES_ORD_DTL ORDDTL
          ON ORDDTL.SLS_ORD_HD_NO = ORDHD.SLS_ORD_HD_NO
        JOIN BF_CMN_FINISH_PRODUCT_CODE FNSPRD
          ON FNSPRD.FIN_PRD_CD_CODE = ORDDTL.FIN_PRD_CD_CODE
        WHERE ORDDTL.SLS_ORD_HD_NO = #{slsOrdHdNo}
   	</select>
   	
   	<!-- 출고관리에서 출고내역 조회 모달-->
   	<select id="outView" resultType="slsOutHdVO">
   		SELECT DISTINCT OUTHD.SLS_OUT_HD_NO,
   			   OUTHD.SLS_OUT_HD_DATE,
   			   OUTHD.SLS_ORD_HD_NO,
   			   VEND.VEND_CD_CODE,
   			   VEND.VEND_CD_NM,
   			   EMP.EMP_NAME,
   			   NVL(OUTHD.SLS_OUT_HD_REMK, ' ') AS SLS_OUT_HD_REMK
   		FROM BF_SALES_OUT_HD OUTHD
   		JOIN BF_CMN_VENDOR_CODE VEND
   		  ON VEND.VEND_CD_CODE = OUTHD.VEND_CD_CODE
   		JOIN BF_CMN_EMP EMP
   		  ON OUTHD.EMP_ID = EMP.EMP_ID
   		  
   		<if test="(outSdate != null and outSdate != '') and (outEdate != null and outEdate != '')">
   			WHERE SLS_OUT_HD_DATE BETWEEN  TO_DATE(#{outSdate}, 'YY/MM/DD') AND TO_DATE(#{outEdate}, 'YY/MM/DD') + 0.9999
        </if>
		ORDER BY SLS_OUT_HD_DATE DESC, SLS_OUT_HD_NO DESC
   	</select>
   	
   	<!-- 출고관리에서 출고내역 상세조회 -->
   	<select id="outDtlView" resultType="slsOutDtlVO">
   		SELECT OUTDTL.SLS_OUT_HD_NO,
   			   FNSPRD.FIN_PRD_CD_CODE,
   			   FNSPRD.FIN_PRD_CD_NAME,
   			   ORDDTL.SLS_ORD_DTL_VOL,
   			   OUTDTL.SLS_OUT_DTL_PRVS_VOL,
   			   OUTDTL.SLS_OUT_DTL_VOL,
   			   OUTDTL.FNS_PRD_STK_LOT_NO,
   			   FNSPRD.FIN_PRD_CD_PRICE
   		FROM BF_SALES_OUT_DTL OUTDTL
   		JOIN BF_SALES_OUT_HD OUTHD
   		  ON OUTHD.SLS_OUT_HD_NO = OUTDTL.SLS_OUT_HD_NO
   		JOIN BF_SALES_ORD_HD ORDHD
   		  ON ORDHD.SLS_ORD_HD_NO = OUTHD.SLS_ORD_HD_NO
   		JOIN BF_SALES_ORD_DTL ORDDTL
   		  ON ORDDTL.SLS_ORD_HD_NO = ORDHD.SLS_ORD_HD_NO
   		JOIN BF_CMN_FINISH_PRODUCT_CODE FNSPRD
   		  ON FNSPRD.FIN_PRD_CD_CODE = OUTDTL.FIN_PRD_CD_CODE
   		JOIN BF_SALES_FINISH_PRODUCT_STOK FNSPRDSK
   		  ON FNSPRDSK.FNS_PRD_STK_LOT_NO = OUTDTL.FNS_PRD_STK_LOT_NO
   		
   		WHERE OUTDTL.SLS_OUT_HD_NO = #{slsOutHdNo} 
   			  AND ORDDTL.FIN_PRD_CD_CODE = OUTDTL.FIN_PRD_CD_CODE
   	</select>
</mapper>