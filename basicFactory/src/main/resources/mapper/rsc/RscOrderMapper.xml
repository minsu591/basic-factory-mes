<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mes.bf.rsc.mapper.RscOrderMapper">
	<select id="orderDetailList" resultType="com.mes.bf.rsc.vo.RscOrderVO">
		SELECT DTS.RSC_ORDER_CODE,
			   DTS.RSC_ORDER_DTL_NO,
			   DTS.RSC_CD_CODE,
			   DTS.RSC_ORDER_VOL,
			   DTS.RSC_ORDER_PRC,
			   NVL(DTS.RSC_ORDER_DTL_REMK,' ') AS RSC_ORDER_DTL_REMK,
			   DTS.VEND_CD_CODE,
			    
			   VEND.VEND_CD_NM, 
			   
			   RSC.RSC_CD_NAME,
			   RSC.RSC_CD_UNIT
			   
          FROM BF_RSC_ORDER_DETAILS DTS
          LEFT JOIN BF_CMN_VENDOR_CODE VEND
            ON DTS.VEND_CD_CODE = VEND.VEND_CD_CODE
          LEFT JOIN BF_CMN_RSC_CODE RSC
            ON DTS.RSC_CD_CODE = RSC.RSC_CD_CODE
            
         WHERE RSC_ORDER_CODE = #{rscOrderCode}
           AND RSC_ORDER_ST = 0
	</select>
	
	<insert id="orderInsert" parameterType="com.mes.bf.rsc.vo.RscOrderVO">
		INSERT INTO BF_RSC_ORDER
		
		VALUES (
			   'RSC_OD' || LPAD(BF_RSC_ORDER_CODE_SEQ.NEXTVAL,3,0), 
			   #{rscOrderTitle}, 
			   #{rscOrderDate}, 
			   #{rscOrderRemk}, 
			   #{empId}
			   )
	</insert>
	<insert id="orderDtInsert" parameterType="com.mes.bf.rsc.vo.RscOrderVO">
		<selectKey keyProperty="rscOrderCode" resultType="String" order="BEFORE">
			SELECT MAX(RSC_ORDER_CODE)
			  FROM BF_RSC_ORDER
		</selectKey>
		INSERT INTO BF_RSC_ORDER_DETAILS
		
		VALUES (
			   'RSC_DTCD' || LPAD(BF_RSC_ORDER_DETAILS_CODE_SEQ.NEXTVAL,4,0),
			   #{rscOrderCode},
			   #{rscCdCode},
			   #{vendCdCode},
			   #{rscOrderVol},
			   0,
			   #{rscOrderPrc},
			   0
			   ,#{rscOrderDtlRemk}
			   )
			   
	</insert>
</mapper>